#!/usr/bin/env python3
"""
–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã fallback - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞.
"""

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

def analyze_fallback_problem():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É fallback."""
    print("üö® –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ FALLBACK - –û–¢–ü–†–ê–í–ö–ê –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ì–û –ü–ê–ö–ï–¢–ê")
    print("=" * 65)
    
    print("üìä –ü–†–û–ë–õ–ï–ú–ê –ò–ó –õ–û–ì–û–í:")
    print("14:38:38 [WARNING] BypassEngine: Calibrator failed. Trying fallbacks (seqovl -> multisplit)...")
    print("14:38:39 [WARNING] BypassEngine: Fallback race (fake+badsum)...")
    print("14:38:40 [ERROR  ] BypassEngine: Strategy failed, sending original packet.")
    
    print("\nüö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:")
    print("–ü–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–≤–∏–∂–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ø–∞–∫–µ—Ç!")
    print("–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:")
    print("  ‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ë–ï–ó –æ–±—Ö–æ–¥–∞")
    print("  ‚ùå DPI –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç (–ø–∞–∫–µ—Ç —á–∏—Å—Ç—ã–π)")
    print("  ‚ùå –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∂–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ '—Ä–∞–±–æ—Ç—ã'")
    print("  ‚ùå –ù–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–±—Ö–æ–¥ –ù–ï –†–ê–ë–û–¢–ê–ï–¢")
    
    print("\nüîç –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢:")
    print("1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è fakeddisorder –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å")
    print("2. –ö–∞–ª–∏–±—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
    print("3. –ü—Ä–æ–±—É—é—Ç—Å—è fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (seqovl, multisplit)")
    print("4. –í—Å–µ fallback —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç")
    print("5. –í –∏—Ç–æ–≥–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è w.send(packet) - –ß–ò–°–¢–´–ô –ø–∞–∫–µ—Ç")
    print("6. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –ë–ï–ó –æ–±—Ö–æ–¥–∞")
    
    print("\nüéØ –ü–û–ß–ï–ú–£ –≠–¢–û –ü–†–û–ë–õ–ï–ú–ê:")
    print("- –¢–µ—Å—Ç–µ—Ä –¥—É–º–∞–µ—Ç —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è '—Ä–∞–±–æ—Ç–∞–µ—Ç'")
    print("- –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ")
    print("- –û–±—Ö–æ–¥ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è")
    print("- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0% —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞")
    
    print("\nüîß –í–û–ó–ú–û–ñ–ù–´–ï –†–ï–®–ï–ù–ò–Ø:")
    print("1. –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ fallback –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç")
    print("2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
    print("3. –û—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–ª–∏–±—Ä–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏")
    print("4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å forced_nofallback —Ä–µ–∂–∏–º")
    
    return True

def find_fallback_code():
    """–ù–∞—Ö–æ–¥–∏—Ç –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞."""
    print("\nüîç –ü–û–ò–°–ö –ö–û–î–ê FALLBACK:")
    
    try:
        with open("core/bypass/engine/windows_engine.py", "r", encoding="utf-8") as f:
            content = f.read()
        
        # –ò—â–µ–º –º–µ—Å—Ç–∞ –≥–¥–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç
        fallback_patterns = [
            "w.send(packet)",
            "sending original packet",
            "Strategy failed",
            "fallback",
        ]
        
        for pattern in fallback_patterns:
            if pattern in content:
                print(f"  ‚úÖ –ù–∞–π–¥–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω: '{pattern}'")
            else:
                print(f"  ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω: '{pattern}'")
        
        # –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ w.send(packet)
        original_sends = content.count("w.send(packet)")
        print(f"\nüìä –ù–∞–π–¥–µ–Ω–æ {original_sends} –º–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞")
        
        if original_sends > 5:
            print("‚ö†Ô∏è  –°–õ–ò–®–ö–û–ú –ú–ù–û–ì–û fallback –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç!")
            print("   –≠—Ç–æ –º–æ–∂–µ—Ç –æ–±—ä—è—Å–Ω—è—Ç—å –ø–æ—á–µ–º—É '—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç'")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
        return False

if __name__ == "__main__":
    success = analyze_fallback_problem()
    if success:
        find_fallback_code()
    
    print("\nüéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:")
    print("–ù—É–∂–Ω–æ –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞")
    print("–ü—É—Å—Ç—å –ª—É—á—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —á–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ–±—Ö–æ–¥–∞")
    
    sys.exit(0 if success else 1)