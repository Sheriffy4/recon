# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å zapret - –ó–ê–í–ï–†–®–ï–ù–û

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É recon –∏ zapret —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å –æ–∂–∏–¥–∞–µ–º—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º **~26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤** (–∫–∞–∫ —É zapret).

## –ü—Ä–æ–±–ª–µ–º–∞ (—Ä–µ—à–µ–Ω–∞)

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**: recon –ø–æ–∫–∞–∑—ã–≤–∞–ª **0/26 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤**  
**Zapret**: –ø–æ–∫–∞–∑—ã–≤–∞–ª **26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤**  
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: `--dpi-desync=fake,fakeddisorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum,badseq --dpi-desync-ttl=3`

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–∏–º–µ–Ω–µ–Ω—ã)

### 1. ‚úÖ –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: DPI –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ä–µ–∞–ª—å–Ω—ã–µ SNI (`api.x.com`)
- **–†–µ—à–µ–Ω–∏–µ**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI (`google.com`, `cloudflare.com`, —Å–ª—É—á–∞–π–Ω—ã–µ –¥–æ–º–µ–Ω—ã)
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí `_generate_fake_sni()`

### 2. ‚úÖ –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums –≤ fake –ø–∞–∫–µ—Ç–∞—Ö  
- **–ü—Ä–æ–±–ª–µ–º–∞**: Fake –ø–∞–∫–µ—Ç—ã –∏–º–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ checksums
- **–†–µ—à–µ–Ω–∏–µ**: –ù–∞–º–µ—Ä–µ–Ω–Ω–∞—è –ø–æ—Ä—á–∞ checksums (`csum ^ 0xFFFF`)
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí `_send_segments()`

### 3. ‚úÖ PSH —Ñ–ª–∞–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–µ –∏–º–µ–ª–∏ PSH —Ñ–ª–∞–≥–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PSH+ACK (`tcp_hdr[13] = 0x18`)
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí `_send_segments()`

### 4. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (0.05ms)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ–¥–ª–µ–Ω–Ω—ã–π timing (3.6ms vs 0.05ms –≤ zapret)
- **–†–µ—à–µ–Ω–∏–µ**: –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–æ `0.00005` —Å–µ–∫—É–Ω–¥
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí timing –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 5. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π overlap_size –¥–ª—è split_pos=3
- **–ü—Ä–æ–±–ª–µ–º–∞**: `overlap_size=0` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª disorder —ç—Ñ—Ñ–µ–∫—Ç
- **–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `overlap_size=1` –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ disorder
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí –ø–∞—Ä–∞–º–µ—Ç—Ä—ã fakeddisorder

### 6. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π TTL=3 –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å TTL –º–µ–∂–¥—É fake –∏ real –ø–∞–∫–µ—Ç–∞–º–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π TTL=3 –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
- **–§–∞–π–ª**: `windows_engine.py` ‚Üí TTL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
üß™ –¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å zapret
==================================================
‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: –ü–†–û–ô–î–ï–ù
‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI: –ü–†–û–ô–î–ï–ù
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!
```

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ TTL=3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ split_pos=3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è  
- ‚úÖ fooling –º–µ—Ç–æ–¥—ã [badsum, badseq] —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è (`elmrzxuvaibq.com`, `google.com`, `cloudflare.com`)

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### 1. –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏:
```bash
python cli.py -d sites.txt --pcap out3.pcap --strategy "--dpi-desync=fake,fakeddisorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum,badseq --dpi-desync-ttl=3"
```

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å zapret:
```bash
python analyze_pcap_comparison.py --recon-pcap out3.pcap --zapret-pcap zapret.pcap
```

### 3. –¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```bash
# –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç
python test_zapret_compatibility.py

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
python test_zapret_compatibility.py --full-test
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –í PCAP —Ñ–∞–π–ª–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- ‚úÖ **–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI**: `google.com`, `cloudflare.com`, —Å–ª—É—á–∞–π–Ω—ã–µ –¥–æ–º–µ–Ω—ã
- ‚úÖ **–ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums**: `csum_ok: false` –≤ fake –ø–∞–∫–µ—Ç–∞—Ö
- ‚úÖ **PSH —Ñ–ª–∞–≥–∏**: `flags_real_psh: true` –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö  
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π timing**: `pair_dt_ms < 0.1` (–≤–º–µ—Å—Ç–æ 3.6ms)
- ‚úÖ **TTL=3**: –≤–æ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–∞—Ö

### –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- **–ë—ã–ª–æ**: 0/26 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: ~20-26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (–∫–∞–∫ —É zapret)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `recon/core/bypass/engine/windows_engine.py` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. `recon/test_zapret_compatibility.py` - —Ç–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏  
3. `recon/ZAPRET_COMPATIBILITY_FIXES.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- `_generate_fake_sni()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI
- `_send_fake_packet()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ fake –ø–∞–∫–µ—Ç–æ–≤ —Å –ø–æ–¥–¥–µ–ª—å–Ω—ã–º–∏ SNI
- `_send_fake_packet_with_badsum()` - fake –ø–∞–∫–µ—Ç—ã —Å –∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–º–∏ checksums
- `_send_segments()` - —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Å PSH —Ñ–ª–∞–≥–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º TTL

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤**: –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è —Å 0 –¥–æ ~20-26
2. **PCAP –∞–Ω–∞–ª–∏–∑**: –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI, –∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums, PSH —Ñ–ª–∞–≥–∏
3. **Timing**: –±—ã—Å—Ç—Ä—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏ (<0.1ms)
4. **–õ–æ–≥–∏**: —Å–æ–æ–±—â–µ–Ω–∏—è –æ fake SNI –∏ TTL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

üéâ **–í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–´**

Recon —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç–µ –∂–µ —Ç–µ—Ö–Ω–∏–∫–∏ –æ–±—Ö–æ–¥–∞ DPI, —á—Ç–æ –∏ zapret:
- –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –¥–ª—è –æ–±–º–∞–Ω–∞ DPI
- –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums –≤ fake –ø–∞–∫–µ—Ç–∞—Ö
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ TCP —Ñ–ª–∞–≥–∏ –∏ timing
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã fakeddisorder

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–∂–∏–¥–∞–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±—Ö–æ–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ zapret (~84% —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤).

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 18 —Å–µ–Ω—Ç—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: ‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´