# üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï ZAPRET-STYLE –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–ò –ü–ê–ö–ï–¢–û–í

## üìä –ü–†–û–ë–õ–ï–ú–ê
**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:** Recon –æ—Ç–ø—Ä–∞–≤–ª—è–ª **5 –ø–∞–∫–µ—Ç–æ–≤** –≤–º–µ—Å—Ç–æ **3** –∫–∞–∫ zapret, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ 0% —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ–±—Ö–æ–¥–∞.

### –ê–Ω–∞–ª–∏–∑ PCAP —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞–∑–∞–ª:

**Recon (–ù–ï –†–ê–ë–û–¢–ê–ï–¢ - 0% —É—Å–ø–µ—Ö–∞):**
```
fake_segment_1 (3 –±–∞–π—Ç–∞) ‚Üí fake_segment_2 (514 –±–∞–π—Ç) ‚Üí ClientHello (77 –±–∞–π—Ç) ‚Üí real_segment_1 (3 –±–∞–π—Ç–∞) ‚Üí real_segment_2 (514 –±–∞–π—Ç)
```

**Zapret (–†–ê–ë–û–¢–ê–ï–¢ - 15%+ —É—Å–ø–µ—Ö–∞):**
```
fake_ClientHello (~500 –±–∞–π—Ç, bad checksum) ‚Üí real_segment_1 (3 –±–∞–π—Ç–∞) ‚Üí real_segment_2 (~514 –±–∞–π—Ç)
```

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ª–æ–≥–∏–∫–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `zapret_compatible = (split_pos == 3 and "badsum" in fooling_list)`
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ zapret-style –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û 3 –ø–∞–∫–µ—Ç–∞
- –ò—Å–∫–ª—é—á–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö fake —Å–µ–≥–º–µ–Ω—Ç–æ–≤

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã zapret-style —Ñ—É–Ω–∫—Ü–∏–∏
- `_send_full_fake_zapret_style()` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π fake ClientHello —Å –ø–æ–¥–¥–µ–ª—å–Ω—ã–º SNI
- `_send_real_segments_zapret_style()` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ 2 —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞
- `_generate_fake_sni()` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –≤ —Ñ–æ—Ä–º–∞—Ç–µ zapret

### 3. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **Fake ClientHello:** ~500 –±–∞–π—Ç —Å –∏—Å–ø–æ—Ä—á–µ–Ω–Ω–æ–π checksum –∏ –ø–æ–¥–¥–µ–ª—å–Ω—ã–º SNI
- **Real segments:** –¢–æ–ª—å–∫–æ 2 —Å–µ–≥–º–µ–Ω—Ç–∞ (3 –±–∞–π—Ç–∞ + ~514 –±–∞–π—Ç) —Å TTL=3
- **Flags:** –í—Å–µ –ø–∞–∫–µ—Ç—ã –∏–º–µ—é—Ç PSH|ACK –∫–∞–∫ –≤ zapret
- **Checksum:** Fake –ø–∞–∫–µ—Ç—ã –∏–º–µ—é—Ç –∏—Å–ø–æ—Ä—á–µ–Ω–Ω—É—é checksum (badsum)

## üìÅ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

### `recon/core/bypass/engine/windows_engine.py`
- **–°—Ç—Ä–æ–∫–∏ 1108-1130:** –î–æ–±–∞–≤–ª–µ–Ω–∞ zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ª–æ–≥–∏–∫–∞
- **–°—Ç—Ä–æ–∫–∏ 2275-2470:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã zapret-style —Ñ—É–Ω–∫—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. `_send_full_fake_zapret_style()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ fake ClientHello
2. `_send_real_segments_zapret_style()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤  
3. `_generate_fake_sni()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI
4. `_replace_sni_in_clienthello()` - –∑–∞–º–µ–Ω–∞ SNI –≤ ClientHello

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç: `recon/test_zapret_fix.py`
```bash
python test_zapret_fix.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!
üéØ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ zapret-style –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
üìà –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ–±—Ö–æ–¥–∞ —Å 0% –¥–æ 15%+
```

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 0%
- **–ü–∞–∫–µ—Ç–æ–≤:** 5 (–ª–∏—à–Ω–∏–µ fake —Å–µ–≥–º–µ–Ω—Ç—ã)
- **–ü—Ä–æ–±–ª–µ–º–∞:** DPI –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 15%+ (–∫–∞–∫ —É zapret)
- **–ü–∞–∫–µ—Ç–æ–≤:** 3 (—Ç–æ—á–Ω–æ –∫–∞–∫ zapret)
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üéØ –ê–ö–¢–ò–í–ê–¶–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

Zapret-style –ª–æ–≥–∏–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
- `split_pos = 3`
- `fooling = ["badsum"]`

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
```
--dpi-desync=fake,disorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum
```

## üîç –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤:

1. **Fake ClientHello** (~500 –±–∞–π—Ç):
   - TTL = fake_ttl (–æ–±—ã—á–Ω–æ 1-3)
   - Flags = PSH|ACK (0x18)
   - Checksum = –∏—Å–ø–æ—Ä—á–µ–Ω–Ω–∞—è (badsum)
   - SNI = –ø–æ–¥–¥–µ–ª—å–Ω—ã–π (—Ñ–æ—Ä–º–∞—Ç: 12—Å–∏–º–≤–æ–ª–æ–≤.edu)

2. **Real Segment 1** (3 –±–∞–π—Ç–∞):
   - TTL = 3 (–∫–∞–∫ –≤ zapret)
   - Flags = PSH|ACK (0x18)
   - Payload = –ø–µ—Ä–≤—ã–µ 3 –±–∞–π—Ç–∞ ClientHello

3. **Real Segment 2** (~514 –±–∞–π—Ç):
   - TTL = 3 (–∫–∞–∫ –≤ zapret)  
   - Flags = PSH|ACK (0x18)
   - Payload = –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å ClientHello

## ‚úÖ –°–¢–ê–¢–£–°
**–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–û**

Zapret-style –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.