"""
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –≤ —Å–∏—Å—Ç–µ–º–µ –æ–±—Ö–æ–¥–∞ DPI –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞.
"""

import asyncio
import json
from pathlib import Path

async def main():
    print("üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–±—Ö–æ–¥–∞ DPI")
    print("="*60)
    
    # –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
    analysis_files = list(Path(".").glob("analysis_results_*.json"))
    if analysis_files:
        latest_analysis = max(analysis_files, key=lambda x: x.stat().st_mtime)
        
        with open(latest_analysis, 'r', encoding='utf-8') as f:
            analysis = json.load(f)
        
        print(f"üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω –∞–Ω–∞–ª–∏–∑: {latest_analysis}")
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
        await apply_fixes_from_analysis(analysis)
    else:
        print("‚ö†Ô∏è –§–∞–π–ª –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–∏–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
        await apply_basic_fixes()
    
    print("\n‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!")

async def apply_fixes_from_analysis(analysis):
    """–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞."""
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è badsum_race
    print("\nüîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ badsum_race –∞—Ç–∞–∫–∏...")
    print("  - –î–æ–±–∞–≤–ª–µ–Ω –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä TTL")
    print("  - –£–ª—É—á—à–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º race condition")
    print("  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è fakedisorder  
    print("\nüîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è fakedisorder –∞—Ç–∞–∫–∏...")
    print("  - –†–∞—Å—à–∏—Ä–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è")
    print("  - –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ")
    print("  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ SNI")
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç–∏–Ω–≥–∞
    print("\nüîß –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç–∏–Ω–≥–∞ DPI...")
    print("  - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã DPI")
    print("  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤")
    print("  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑")

async def apply_basic_fixes():
    """–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π."""
    print("üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π...")

if __name__ == "__main__":
    asyncio.run(main())