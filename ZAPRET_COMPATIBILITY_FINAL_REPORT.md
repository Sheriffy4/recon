# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å zapret

## ‚úÖ –°–¢–ê–¢–£–°: –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É recon –∏ zapret —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ zapret (~26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤).

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- **Recon**: 0/26 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- **Zapret**: 26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤  
- **–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: `--dpi-desync=fake,fakeddisorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum,badseq --dpi-desync-ttl=3`

### –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ PCAP:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Zapret (—Ä–∞–±–æ—Ç–∞–µ—Ç) | Recon (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª) | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|----------|-------------------|-------------------|------------|
| **SNI** | `cgz0tadj7bodz.edu` (–ø–æ–¥–¥–µ–ª—å–Ω—ã–π) | `api.x.com` (—Ä–µ–∞–ª—å–Ω—ã–π) | ‚úÖ |
| **Checksum** | `csum_ok: false` (–∏—Å–ø–æ—Ä—á–µ–Ω) | `csum_ok: true` (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π) | ‚úÖ |
| **PSH —Ñ–ª–∞–≥** | `flags_real_psh: true` | `flags_real_psh: false` | ‚úÖ |
| **Timing** | `pair_dt_ms: 0.055` | `pair_dt_ms: 3.636` | ‚úÖ |
| **Overlap** | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π disorder | `overlap_size: 0` | ‚úÖ |

## üõ†Ô∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI (–ö–†–ò–¢–ò–ß–ù–û!)

**–ü—Ä–æ–±–ª–µ–º–∞**: DPI –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ä–µ–∞–ª—å–Ω—ã–µ SNI (`api.x.com`, `twitter.com`)

**–†–µ—à–µ–Ω–∏–µ**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
```python
def _generate_fake_sni(self, original_sni):
    fake_domains = ["google.com", "microsoft.com", "cloudflare.com", ...]
    # –ò—Å–∫–ª—é—á–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
    fake_domains = [d for d in fake_domains if d != original_sni.lower()]
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–¥–¥–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `api.x.com` ‚Üí `apple.com`, `twitter.com` ‚Üí `google.com`

### 2. ‚úÖ –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums –≤ fake –ø–∞–∫–µ—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: Fake –ø–∞–∫–µ—Ç—ã –∏–º–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ checksums

**–†–µ—à–µ–Ω–∏–µ**: –ù–∞–º–µ—Ä–µ–Ω–Ω–∞—è –ø–æ—Ä—á–∞ checksums
```python
# –í _send_full_fake_zapret_style()
bad_csum = good_csum ^ 0xFFFF  # –ü–æ—Ä—Ç–∏–º checksum
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `csum_fake_bad: true` –≤ PCAP

### 3. ‚úÖ PSH —Ñ–ª–∞–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–µ –∏–º–µ–ª–∏ PSH —Ñ–ª–∞–≥–∞

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PSH+ACK
```python
# –í _send_segments()
tcp_hdr[13] = 0x18  # PSH+ACK –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `flags_real_psh: true` –≤ PCAP

### 4. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ–¥–ª–µ–Ω–Ω—ã–π timing (3.6ms vs 0.05ms –≤ zapret)

**–†–µ—à–µ–Ω–∏–µ**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –±—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
```python
time.sleep(0.00005)  # 0.05ms –∫–∞–∫ –≤ zapret (–±—ã–ª–æ 0.5ms)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `pair_dt_ms < 0.1` –≤ PCAP

### 5. ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–¥ –Ω–µ –ø–æ–ø–∞–¥–∞–ª –≤ zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º—É—é –≤–µ—Ç–∫—É

**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
```python
zapret_compatible = (split_pos == 3 and "badsum" in fooling_list)
is_simple = forced_nofallback or zapret_compatible
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `_send_full_fake_zapret_style()`

### 6. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π overlap_size

**–ü—Ä–æ–±–ª–µ–º–∞**: `overlap_size=0` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª disorder —ç—Ñ—Ñ–µ–∫—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overlap –¥–ª—è disorder
```python
if params.get("split_pos") == 3:
    params["overlap_size"] = 1  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overlap
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç:
```
‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π zapret —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
=======================================================
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏...
  ‚úÖ TTL=3
  ‚úÖ split_pos=3
  ‚úÖ badsum fooling
  ‚úÖ badseq fooling
  ‚úÖ fakeddisorder type

üé≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ fake SNI...
  ‚úÖ api.x.com -> apple.com
  ‚úÖ twitter.com -> google.com
  ‚úÖ facebook.com -> yahoo.com

üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ zapret —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏...
  ‚úÖ Zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã
  ‚úÖ –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å (is_simple=True)

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: 3/3 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!
```

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```
üß™ –¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å zapret
==================================================
‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: –ü–†–û–ô–î–ï–ù
‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI: –ü–†–û–ô–î–ï–ù
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!
```

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```bash
python quick_test_zapret_fix.py
```

### 2. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```bash
python test_zapret_compatibility.py
```

### 3. –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –¥–æ–º–µ–Ω–∞–º–∏:
```bash
python cli.py -d sites.txt --pcap test_fixed.pcap --strategy "--dpi-desync=fake,fakeddisorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum,badseq --dpi-desync-ttl=3"
```

### 4. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```bash
python analyze_pcap_comparison.py --recon-pcap test_fixed.pcap --zapret-pcap zapret.pcap
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –í –Ω–æ–≤–æ–º PCAP –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- ‚úÖ **–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI**: `google.com`, `apple.com`, `microsoft.com` (–ù–ï `api.x.com`)
- ‚úÖ **–ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums**: `csum_fake_bad: true`
- ‚úÖ **PSH —Ñ–ª–∞–≥–∏**: `flags_real_psh: true`
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π timing**: `pair_dt_ms < 0.1` (–≤–º–µ—Å—Ç–æ 3.6ms)
- ‚úÖ **TTL=3**: –≤–æ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–∞—Ö

### –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö CLI:
- **–ë—ã–ª–æ**: 0/26 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: ~20-26/31 —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (–∫–∞–∫ —É zapret)

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`recon/core/bypass/engine/windows_engine.py`** - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. **`recon/test_zapret_compatibility.py`** - –ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. **`recon/quick_test_zapret_fix.py`** - –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
4. **`recon/ZAPRET_COMPATIBILITY_*.md`** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîß –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã

- `_generate_fake_sni()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö SNI
- `_send_full_fake_zapret_style()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ fake –ø–∞–∫–µ—Ç–æ–≤ —Å –ø–æ–¥–¥–µ–ª—å–Ω—ã–º–∏ SNI
- `_send_segments()` - —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Å PSH —Ñ–ª–∞–≥–∞–º–∏ –∏ –∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–º–∏ checksums
- –õ–æ–≥–∏–∫–∞ `zapret_compatible` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
1. –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. Checksums –ø–æ—Ä—Ç—è—Ç—Å—è –≤ fake –ø–∞–∫–µ—Ç–∞—Ö
3. PSH —Ñ–ª–∞–≥–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
4. Timing –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–æ zapret —É—Ä–æ–≤–Ω—è
5. Zapret-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –ø—É—Ç—å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:
- –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ‚úÖ
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è fake SNI: ‚úÖ
- –õ–æ–≥–∏–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏: ‚úÖ

### üéØ –û–∂–∏–¥–∞–µ–º–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
**~84% —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤** (26/31 –∫–∞–∫ —É zapret)

---

## üí° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç**:
   ```bash
   python cli.py -d sites.txt --pcap test_fixed.pcap --strategy "--dpi-desync=fake,fakeddisorder --dpi-desync-split-pos=3 --dpi-desync-fooling=badsum,badseq --dpi-desync-ttl=3"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ PCAP**:
   - –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ SNI –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö
   - –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ checksums –≤ fake –ø–∞–∫–µ—Ç–∞—Ö
   - PSH —Ñ–ª–∞–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
   - –ë—ã—Å—Ç—Ä—ã–π timing –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏

3. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è —Å 0 –¥–æ ~20-26
   - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –¥–æ—Å—Ç–∏—á—å —É—Ä–æ–≤–Ω—è zapret

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 18 —Å–µ–Ω—Ç—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ  
**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´