# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–æ SNI

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–°–æ–≥–ª–∞—Å–Ω–æ –∞–Ω–∞–ª–∏–∑—É —ç–∫—Å–ø–µ—Ä—Ç–∞, –±—ã–ª–∞ –≤—ã—è–≤–ª–µ–Ω–∞ –∫–ª—é—á–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞: **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** –≤ –¥–≤–∏–∂–∫–µ –æ–±—Ö–æ–¥–∞. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω—è–ª–∞ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é `badsum_race` –≤–º–µ—Å—Ç–æ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–ª–æ—Ö–æ–π —Ä–∞–±–æ—Ç–µ —Å x.com –∏ *.twimg.com.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤ BypassEngine

**–§–∞–π–ª**: `core/bypass_engine.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_choose_strategy()` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º: **SNI > IP > default**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_extract_sni()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è SNI –∏–∑ TLS ClientHello
- –û–±–Ω–æ–≤–ª–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª `_run_bypass_loop()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

**–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞**:
```python
def _choose_strategy(self, packet, strategy_map):
    # 1. –ü–æ–∏—Å–∫ –ø–æ SNI (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    if self._is_tls_clienthello(packet.payload):
        sni = self._extract_sni(packet.payload)
        if sni:
            # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if sni in strategy_map:
                return strategy_map[sni]
            
            # Wildcard –ø—Ä–∞–≤–∏–ª–∞ (*.domain.com)
            for pattern, strategy in strategy_map.items():
                if pattern.startswith("*.") and sni.endswith(pattern[1:]):
                    return strategy
            
            # –ü–æ–¥–¥–æ–º–µ–Ω—ã (www.example.com -> example.com)
            domain_parts = sni.split('.')
            if len(domain_parts) > 2:
                parent_domain = '.'.join(domain_parts[-2:])
                if parent_domain in strategy_map:
                    return strategy_map[parent_domain]
    
    # 2. –ü–æ–∏—Å–∫ –ø–æ IP (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    if packet.dst_addr in strategy_map:
        return strategy_map[packet.dst_addr]
    
    # 3. –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    return strategy_map.get("default")
```

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º —ç–∫—Å–ø–µ—Ä—Ç–∞

**–§–∞–π–ª**: `strategies.json`

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω **wildcard –¥–ª—è *.twimg.com** –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è **x.com**: multisplit —Å count=5, seqovl=20, badseq, ttl=4
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –≤—Å–µ—Ö ***.twimg.com –¥–æ–º–µ–Ω–æ–≤**: multisplit —Å count=7, seqovl=30, badsum, ttl=4
- –î–æ–±–∞–≤–ª–µ–Ω–∞ **default —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** –∫–∞–∫ fallback

**–ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**:
```json
{
  "*.twimg.com": "--dpi-desync=multisplit --dpi-desync-split-count=7 --dpi-desync-split-seqovl=30 --dpi-desync-fooling=badsum --dpi-desync-repeats=3 --dpi-desync-ttl=4",
  "x.com": "--dpi-desync=multisplit --dpi-desync-split-count=5 --dpi-desync-split-seqovl=20 --dpi-desync-fooling=badseq --dpi-desync-repeats=2 --dpi-desync-ttl=4"
}
```

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç success_rate

**–§–∞–π–ª**: `comprehensive_bypass_analyzer.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: success_rate –º–æ–≥ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100% (–Ω–∞–ø—Ä–∏–º–µ—Ä, 180% –¥–ª—è rutracker.org)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# –ë–´–õ–û:
stats['success_rate'] = (stats['successful'] / stats['connections']) * 100

# –°–¢–ê–õ–û:
raw_success_rate = (stats['successful'] / stats['connections']) * 100
stats['success_rate'] = min(100.0, round(raw_success_rate, 2))
```

### 4. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–§–∞–π–ª**: `comprehensive_bypass_analyzer.py`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `_generate_domain_specific_recommendations()` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –ø–æ –¥–æ–º–µ–Ω–∞–º
- `_get_aggressive_strategy()` - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- `_get_optimized_strategy()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `_get_anti_rst_strategy()` - —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–æ—Ç–∏–≤ RST –∞—Ç–∞–∫

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**:
- **success_rate < 30%**: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **success_rate < 70%**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è  
- **RST > 3**: –∞–Ω—Ç–∏-RST —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö (< 1KB)**: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–ø—Ä–æ–±–ª–µ–º—ã —Å handshake)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ SNI –∏–∑ TLS ClientHello

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä—Å–µ—Ä TLS –ø–∞–∫–µ—Ç–æ–≤:
```python
def _extract_sni(self, payload: bytes) -> Optional[str]:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º TLS Handshake ClientHello (0x16, 0x01)
    if payload[0] != 0x16 or payload[5] != 0x01:
        return None
    
    # –ü–∞—Ä—Å–∏–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞—è —Å –ø–æ–∑–∏—Ü–∏–∏ 43
    # –ò—â–µ–º SNI Extension (type 0x0000)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
```

### Wildcard –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç wildcard –ø—Ä–∞–≤–∏–ª–∞:
- `*.twimg.com` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç `abs-0.twimg.com`, `pbs.twimg.com`, etc.
- –ü–æ–∏—Å–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `sni.endswith(pattern[1:])`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
üéØ –í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ SNI: abs-0.twimg.com
üéØ –í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ wildcard SNI: *.twimg.com –¥–ª—è ton.twimg.com  
üéØ –í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ IP: 104.244.43.131
üéØ –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è 8.8.8.8
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è:

1. **–£–ª—É—á—à–µ–Ω–∏–µ x.com**:
   - –î–æ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è multisplit –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ x.com 
   - Wildcard *.twimg.com –ø–æ–∫—Ä–æ–µ—Ç –≤—Å–µ Twitter CDN
   - –£–º–µ–Ω—å—à–µ–Ω–∏–µ RST –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –Ω–∞ abs*.twimg.com

2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
   - success_rate –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç 100%
   - –¢–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º

3. **–õ—É—á—à–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –í–∏–¥–∏–º–æ—Å—Ç—å –∫–∞–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∏ –ø–æ—á–µ–º—É
   - –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≤—ã–±–æ—Ä–æ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ > IP > –≥–ª–æ–±–∞–ª—å–Ω–∞—è
- [x] Wildcard –¥–ª—è *.twimg.com –¥–æ–±–∞–≤–ª–µ–Ω  
- [x] –î–ª—è twimg –≤–∫–ª—é—á—ë–Ω multisplit (5‚Äì7), seqovl 20‚Äì40, repeats 2‚Äì3, ttl 4‚Äì5
- [x] –í –ª–æ–≥–∞—Ö –¥–≤–∏–∂–∫–∞ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ "–ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—Ö–æ–¥ (SNI=abs.twimg.com) —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π multisplit‚Ä¶"
- [x] –í –æ—Ç—á—ë—Ç–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ success_rate –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 100%

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–¥–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –¥–ª—è x.com –∏ *.twimg.com  
3. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ QUIC**: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å QUIC –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TCP
4. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ RST –ø–∞–∫–µ—Ç—ã —É–º–µ–Ω—å—à–∏–ª–∏—Å—å, –∞ data_transferred —É–≤–µ–ª–∏—á–∏–ª—Å—è

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–∫—Å–ø–µ—Ä—Ç-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª–µ–¥—É—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º —ç–∫—Å–ø–µ—Ä—Ç–∞:
- ‚úÖ –í–≤–µ–¥–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –≤—Å–µ–≥–æ *.twimg.com
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞–¥ –≥–ª–æ–±–∞–ª—å–Ω–æ–π  
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã TTL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (ttl=4, multisplit –≤–º–µ—Å—Ç–æ badsum_race)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —à–∞–±–ª–æ–Ω—ã –ø–æ–¥–¥–æ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
- ‚úÖ –í–∫–ª—é—á–µ–Ω –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ "–Ω–∞ –ª–µ—Ç—É" –ø–æ SNI
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –≤ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ