# Fake Mode Guide

## –ß—Ç–æ —Ç–∞–∫–æ–µ Fake Mode?

Fake Mode –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ fake –ø–∞–∫–µ—Ç—ã (—Å –Ω–∏–∑–∫–∏–º TTL –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å multisplit –∞—Ç–∞–∫–æ–π.

## –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### 1. `per_fragment` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

–°–æ–∑–¥–∞–µ—Ç fake –ø–∞–∫–µ—Ç –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ** —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞.

**–ü—Ä–∏–º–µ—Ä**: split_count=6 ‚Üí 6 fake + 6 real = 12 –ø–∞–∫–µ—Ç–æ–≤

```json
{
  "domain.com": {
    "params": {
      "fake_mode": "per_fragment",
      "split_count": 6,
      "ttl": 1,
      "fooling": "badseq"
    },
    "attacks": ["fake", "multisplit", "disorder"]
  }
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ DPI —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ heuristics
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ùå –ë–æ–ª—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (2x)
- ‚ùå –ë–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

---

### 2. `per_signature` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

–°–æ–∑–¥–∞–µ—Ç fake —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö **—Å–∏–≥–Ω–∞—Ç—É—Ä—É** (SNI/Host).

**–ü—Ä–∏–º–µ—Ä**: split_count=6, SNI –≤ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö 2-3 ‚Üí 2 fake + 6 real = 8 –ø–∞–∫–µ—Ç–æ–≤

```json
{
  "domain.com": {
    "params": {
      "fake_mode": "per_signature",
      "split_count": 6,
      "ttl": 1,
      "fooling": "badseq"
    },
    "attacks": ["fake", "multisplit", "disorder"]
  }
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ –ò–∑–≤–µ—Å—Ç–Ω–∞ –ø–æ–∑–∏—Ü–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
- ‚úÖ –í–∞–∂–Ω–∞ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π stateless DPI

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ payload
- ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

---

### 3. `smart` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç fake —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ.

**Fallback**: –ï—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí fake –¥–ª—è –ø–µ—Ä–≤—ã—Ö 2-3 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä**: 
- –° —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π: 2 fake + 6 real = 8 –ø–∞–∫–µ—Ç–æ–≤
- –ë–µ–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã: 3 fake + 6 real = 9 –ø–∞–∫–µ—Ç–æ–≤

```json
{
  "domain.com": {
    "params": {
      "fake_mode": "smart",
      "split_count": 6,
      "ttl": 1,
      "fooling": "badseq"
    },
    "attacks": ["fake", "multisplit", "disorder"]
  }
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
- ‚úÖ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | per_fragment | per_signature | smart |
|----------|--------------|---------------|-------|
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –¢—Ä–∞—Ñ–∏–∫ | –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∏–π | –°—Ä–µ–¥–Ω–∏–π |
| –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ (per_fragment)

```json
{
  "blocked-site.com": {
    "type": "fake",
    "params": {
      "fake_mode": "per_fragment",
      "split_count": 8,
      "ttl": 1,
      "fooling": "badseq",
      "disorder_method": "reverse"
    },
    "attacks": ["fake", "multisplit", "disorder"]
  }
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: 8 fake + 8 real = 16 –ø–∞–∫–µ—Ç–æ–≤

---

### –ü—Ä–∏–º–µ—Ä 2: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ö–æ–¥ (smart)

```json
{
  "example.com": {
    "type": "fake",
    "params": {
      "fake_mode": "smart",
      "split_count": 6,
      "ttl": 1,
      "fooling": "badseq"
    },
    "attacks": ["fake", "multisplit"]
  }
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: 2-3 fake + 6 real = 8-9 –ø–∞–∫–µ—Ç–æ–≤

---

### –ü—Ä–∏–º–µ—Ä 3: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ (per_signature)

```json
{
  "lightweight.com": {
    "type": "fake",
    "params": {
      "fake_mode": "per_signature",
      "split_count": 4,
      "ttl": 1,
      "fooling": "badseq"
    },
    "attacks": ["fake", "multisplit"]
  }
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: 1-2 fake + 4 real = 5-6 –ø–∞–∫–µ—Ç–æ–≤

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `fake_mode` –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `per_fragment` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```json
{
  "domain.com": {
    "params": {
      "split_count": 6,
      "ttl": 1
    },
    "attacks": ["fake", "multisplit"]
  }
}
```

–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:

```json
{
  "domain.com": {
    "params": {
      "fake_mode": "per_fragment",  // ‚Üê –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      "split_count": 6,
      "ttl": 1
    },
    "attacks": ["fake", "multisplit"]
  }
}
```

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è fake_mode

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞:

```
[INFO] üîÑ Detected fake + multisplit combination, using integrated mode
[INFO] ‚úÇÔ∏è Splitting payload: pos=2, count=6, payload_size=503 bytes
[INFO] ‚úÖ Split into 6 fragments: [83, 83, 83, 83, 83, 88] bytes
[INFO] üé≠ Applying fake to 6 fragments using mode: per_fragment
[INFO] ‚úÖ Generated 12 packets: 6 fake + 6 real
```

### –ê–Ω–∞–ª–∏–∑ PCAP

```bash
python analyze_log_pcap.py log1.pcap
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –¥–ª—è `fake_mode: per_fragment`:
```
Attack Detection:
  Fake packets: 6
  Real packets with payload: 6
  Split detected: YES (fragments: 6)
  Disorder detected: YES
```

---

## FAQ

### Q: –ö–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—ã–±—Ä–∞—Ç—å?

**A**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `smart` - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

### Q: –ü–æ—á–µ–º—É per_fragment –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–æ–ª—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞?

**A**: –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è fake –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞. –≠—Ç–æ –Ω–∞–¥—ë–∂–Ω–µ–µ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –ø–∞–∫–µ—Ç–æ–≤.

### Q: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å per_signature?

**A**: –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –≤—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å–∏–≥–Ω–∞—Ç—É—Ä—ã.

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ fake_mode –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**A**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è unified_attack_dispatcher.

---

## –°–º. —Ç–∞–∫–∂–µ

- [Attack Application Parity](../specs/attack-application-parity/requirements.md)
- [Deep Compare Integration](deep_compare_updates.md)
- [Metrics System](metrics_system.md)
